Spatial-temporal Multi-Task Learning for Within-field Cotton Yield Prediction

Abstract
Understanding and accurately predicting within-field spatial variability of crop yield play a key role in site-specific management of crop inputs such as irrigation water and fertilizer for optimized crop production. However, such a task is challenged by the complex interaction between crop growth and environmental and managerial factors, such as climate, soil conditions, tillage, and irrigation. In this paper, we present a novel Spatial-temporal Multi-Task Learning algorithms for within-field crop yield prediction in west Texas from 2001 to 2003. This algorithm integrates multiple heterogeneous data sources to learn different features simultaneously, and to aggregate spatial-temporal features by introducing a weighted regularizer to the loss functions. Our comprehensive experimental results consistently outperform the results of other conventional methods, and suggest a promising approach, which improves the landscape of crop prediction research fields.

Introduction
Cotton is an important cash crop native to tropical and subtropical regions in the world. Accurate yield prediction not only provides valuable information to cotton producers for effective management of the crop for optimized production, but also is important to policymakers, as well as consumers of agricultural products. However, cotton yield prediction is challenging due to complex interactions between crop growth and weather factors, soil conditions, as well as management factors, such as irrigation, tillage, rotation, etc. Moreover, simply applying other crop yield prediction models on cotton may lead nothing but disappointment: A prediction model that works on other crops like wheat, rice, and sugarcane, however, fails on predicting cotton yield  #b0 .The existing approaches estimate crop yield based either on the crop sown areas, crop-cutting experiments or market arrivals show wide variability because of their inability to capture the indeterminate nature of the crop and its response to environmental conditions  #b1 . One of the attempts is to apply Grey model  #b2  #b3  on production prediction, utilizing short-term forecasting with exponential growth. The regression-based method such as time series analysis can also be applied to production prediction  #b4  #b5 , but it suffers from great variation when the external environment is under significant variation. Another frequently used method for prediction is the differential equation model  #b6 , which demands the system to be stable and requires extra work to solve the equation.Conventional yield prediction treats the field uniformly despite inherent variability. Uniform management may result in over-or under-application of resources in specific locations within a field, which may have a negative impact on the environment and profitability  #b7 . However, consistent and accurate withinfield yield prediction is challenging due to the high accuracy requirement under the complex interactions between yield-influencing factors, such as soil, weather, water, and spatial correlations.With the introduction of the global positioning system (GPS), geographic information systems (GIS), and yield monitors along with other new technologies, we can quantify spatial variability in soil properties and crop yield in small areas of a field. As satellite and drone technologies develop, we are able to collect remote sensing images at fine resolutions to support within-field yield forecast. Within-field scale crop yield prediction provides valuable information for producers to site-specifically manages their crop, which can optimize crop production for maximum profitability. In the within-field prediction procedure, we use a 30-m grid to represent a continuous surface.The advancement of machine learning offers a different approach compared with the traditional ways for yield forecasting. The rapid advances in sensing technologies, the use of fully automated data recording, unmanned systems, remote sensing through satellites or aircraft, and real-time non-invasive computer vision, are additional boosts for enabling the new yield forecasting model. Due to the capability of machine learning based systems to process a large number of inputs and handle non-linear tasks, people have attempted to predict countylevel soybean yield in the United States  #b8  #b9 . However, using deep learning for within-field cotton forecast remains as an untouched ground. In our work, the within-field forecasting is based on each individual grid for one field in West Texas area across three years (2001,2002,2003) in order to predict the cotton yield before harvest.On this account, we propose a Multi-Task learning model to predict withinfield cotton yield. As shown in Figure 1, this model ingests many sources of data which contain features for different learning tasks, including soil topographic attributes (elevation, slope, curvature, etc.), spectral data (Blue, Green, Red, and NIR bands denoted as BAND1, BAND2, BAND3, and BAND4, respectively), normalized difference vegetation index (NVDI) during the crop seasons; and weather (temperature, rainfall, etc.) data. These multiple data sources are aggregated in the shared layer before transferring to task-specific layers. This type of design in a Multi-Task learning model makes it capable of enhancing specific learning task by utilizing all sources of information of other related tasks. In other words, this allows us to take various factors and variables into consideration to achieve a more accurate yield prediction. On the other hand, crop yield within a field is typically autocorrelated, meaning yield values close together are likely more similar than those farther apart. Hence, to incorporate the spatial relationship, we propose a spatial regularization term to minimize the yield difference between one region and the weighted average of neighboring regions.The main contributions of this paper are summarized as below:-We design an innovative multi-task learning approach to predict withinfield cotton yield across several years. Different from other machine learning models, to predict the cotton yield for a specific year is one of the tasks in our model; each individual task is enhanced through its access to all available data from prior years. -This work provides an entirely new vision for grid-scale crop yield prediction.To the best of our knowledge, this is among the first attempts to predict finegrain cotton yield with the Multi-Task Learning approach, as existing work focus more on county-level or country level. -We introduce a spatial weight regularizer in order to overcome the effects of geographical distance on yield prediction. Each grid is trained to minimize not only the difference between the prediction and the actual value, but also the difference between its yield and its neighbors. -We perform a comprehensive set of experiments using the real-world dataset that produced results consistently outperformed other competitive methods, which could provide guidance for achieving higher crop production.

Related Work
Crop Yield Prediction. Crop yield prediction is challenging. Many researches are conducted based on NDVI derived from the new moderate resolution imaging spectroradiometer (MODIS) sensor  #b10 , MODIS two-band Enhanced Vegetation Index  #b11 , even future weather variables  #b12 . Various methodologies are employed, such as statistical models  #b13 , fuzzy systems and Artificial Neural Networks  #b14 , deep long short-term memory model  #b8  and deep neural network  #b15 . Ji et al.  #b16  investigated the effectiveness of machine learning methods. Unfortunately, most of the academic endeavors centered on Artificial Neural Networks with one or a few data sources undermine their predict performance; Most previous studies assuming the crop yield uniformly distributed over space ignore the spatial variations.Multi-Task Learning. Multi-Task learning (MTL) is implemented to predict spatial events due to its competence to exploit dynamic features and scalability  #b17 . Through learning multiple related tasks simultaneously and treating prediction at each time point as a single task, MTL captures the progression trend of Alzheimer's Disease better  #b18 . MTL also has outstanding performance in event forecasting across cities  #b17  and fine-grain sentiment analysis  #b19 , as well as in distance speech recognition  #b20 . Lu et al. proposed a principled approach for designing compact MTL architecture by starting with a thin network and dynamically widening it in a greedy manner  #b21 . To the best of our knowledge, usage of MTL in crop yield forecast in within-field practice is untouched. We propose a Multi-Task Learning model which targets at predicting each grid in the field for a crop season as an individual task. Meanwhile, we incorporate the spatial correlations as a regularization term to minimize the prediction errors. We utilized the Dense and Dropout layers in the network. A shared Dense layer is used to extract latent features from all data dimensions, which are aggregated and fed into multiple sub-networks for yearly yield forecasting task. This aggregation is shared among all task-specific sub-networks. Therefore, it helps the task-specific sub-network to learn features from other tasks and to enhance its own prediction performance. Dense layer helps receive input from all the neurons in the previous layer with the intuition that all factors contribute each layer output neurons. Mathematically, the latent featurep t learned after a fully connected layer is computed as:pt = σ( N i=1 x i * w i + b)(1), where x i represents input feature, w i is a weight element, b is a bias and σ is the activation function. In our setting, σ(x) is a Sigmoid function defined as σ(x) = 1/(1 + e −x ). Moreover, the dropout layer or dropout regularization is also used to randomly exclude some neurons (in our setting, we exclude 20% of the neurons) to avoid over-fitting.

Cotton Yield Prediction
Our feature set is enriched by concatenating the latent features and feeding the output into a shared Dense layer. Suppose p t1 , p t2 , p t3 and p t4 are features from our sources, the joint feature v f c is the concatenation (denote as ⊕) of those features  #b22 :v f c = p t1 ⊕ p t2 ⊕ p t3 ⊕ p t4 .(2)Stacked on the top of the shared Dense layer are three separate sub-networks, and each is used for one yearly cotton yield forecasting task, as shown in Figure  2. After this layer, the latent feature is learned at time j following the equation:h j = σ(W j * v f c j + b).Because cotton is usually planted by the end of May and harvest at the end of September or early October, we cut cotton's life cycle into several pieces, and each piece represents 2 weeks. Instead of taking it as time series data, we treat it as a couple of separate temporal features and utilize fully connected Dense layers and Dropout layers behind the shared Dense layer. We define the regression function for task t as:y t j = σ(W t j * h t j + b t j )(3), where W t j and b t j are learnable parameters, h t j is the output of the last hidden layer, and σ is a linear activation function. The model output lies in the interval [0, 1] after value normalization. We will recover them to the original values when doing performance evaluation.

Spatial Feature in the Loss Function
A loss function is defined as the mean square error between the observation and the prediction:L(θ) = N k=1 (y k −ŷ k ) 2(4), where θ means all learnable parameters, N is the number of regions in the field, y k represents actual yield value, andŷ k represents the predicted yield value. To train θ by minimizing the loss function may introduce overfitting. Therefore, for the grid-scale crop forecasting within a field, the spatial correlations depend heavily on the factor of distance. This drives us to add a regularization term that the yield difference between the predicting region and the weighted average yield of the neighboring regions should be minimized. In particular, suppose G(k) is the set of neighbors of region k, and w(k, j) is the inverse distance weight between region k and region j, the loss function now becomes:L(θ) = N k=1 [(y k −ŷ k ) 2 + λ j∈G(k) w(k, j) |G(k)| * |ŷ k − y j | 2 ](5), where λ is the hyper parameter, d(k, j) is the Euclidean distance between these regions k = j. The spatial weight w(k, j) is computed as:w(k, j) = 1 d(k, j) p(6), where p is the power parameter (which equals to 2 in our experiment).

Experiments


Dataset and Feature Extraction
Our dataset includes weather data, soil properties, spectral data, and NDVI. Spectral data and NDVI are extracted from Lantsat 5 and Landsat 7 remote sensing images. The multi-spectral images were collected from 2001 to 2003 of a cotton field in west Texas. The total area is approximately 48 ha. The sensed images spatial resolution is 30 m. Hence, there are 475 grid cells under investigation. Figure 3 shows the distribution of some features over the field.Weather data. Weather data includes the daily temperature and rainfall level. For simplicity, we use the average of every two weeks' weather data as features to match the sensed images.Soil properties. Topographic variation is a common characteristic of large agricultural fields that has effects on spatial variability of soil water and ultimately on crop yield  #b23 . Besides, soil electrical conductivity (ECa) is also a reliable measurement of field variability. The relationship between ECa and crop yield depends on climate, crop type and other specific field conditions  #b24 . The variables that are considered in this paper include elevation, slope, curvature, the average electrical conductivity of soil, etc.Field spectral data before planting. Field spectrum before planting may influence the entire crop yield. This data is composed of four spectral bands extracted from the sensed images with 30-metre spatial resolution. Band1, Band2, Band3, and Band4 represent blue, green, red and near infrared value, respectively.NDVI data. NDVI represents Normalized Difference Vegetation Index. It is typically related to amount or density of vegetation, which is calculated as the difference between the reflectance in near-infrared (which vegetation strongly reflects) and red wavelengths divided by the sum of these two. NDVI is computed as: N DV I = N IR−RED N IR+RED , where N IR represents the spectral reflectance in nearinfrared wavelength and RED is the spectral reflectance in the red wavelength.

Competing Approaches and Comparison Metrics
Competing Approaches: In our experiment, a list of classical forecasting models are used for comparison and analysis:Linear Regression This is a traditional linear regression model. Its standard formula is: y = n i=1 α i x i + where y is the response variable, x i is the feature and is the deviation.Decision Tree Regression This method builds regression models in the form of a tree structure. It breaks down a dataset into smaller and smaller subsets while an associated regression tree is incrementally developed at the same time. The splitting point is chosen with the smallest sum of squared error (SSE) between predicted values and actual values. In the case of a regression model, the target variable does not have class.Random Forest This model tries to fit a number of regression trees on various sub-samples of the dataset and uses averaging to improve the predictive accuracy and control overfitting. Each leaf of the tree contains a distribution for the continuous output variable. Support Vector Regression (SVR) SVR is a nonparametric technique that aims to find a function f (x) that produces output deviated from observed response values y n by a value no greater than for each training point x, and meanwhile, as flat as possible.XGBoost This is an extension of gradient boosting machine (GBM) algorithm that tries to divide the optimization problem into two parts by first determining the direction of the step and then optimizing the step length.  M SE = 1 N N i=1 (A i − F i ) 2 , RM SE = √ M SE, M AE = 1 N N i=1 |A i − F i |, M AP E = 100% N N i=1 |Ai−Fi| Ai and M E = max(|A i − F i |) where i = 1, ..., N .

Experimental Results
Average Performance Figure 4 shows the performance of our proposed model compared with other baselines in term of RMSE metric. We can see that, the Multi-Task learning and our proposed Spatial-Temporal Multi-Task learning model have the least error in all three years. Figure 6 and Table 1 

Real-time Prediction Throughout the Year
Considering the life cycle of cotton in the U.S., we train the model using partially available input features and predict the cotton yield in each month in an online manner. Figure 5 shows the performance when we try to make a prediction in May, June, July, August and September, using only the data available up to that point. As more information is available, most of the models improve. The improvement during the first three months is less than that of later two months. All models perform better in August and reach the best in September.Spatial Correlations: We also vary the neighborhood distance of each region from 1 to 5 to verify the impact of spatial correlation among regions under prediction. As shown in Figure 7, MSE, RMSE and MAE gradually decrease when the distance increases. This trend stops when neighborhood size equals to 4. The performance becomes more stable afterwards. Even though we see a random value in MAPE and ME metrics with respect to the neighborhood distance, there is also a decreasing trend on MAPE and ME when neighborhood size increases. Therefore, in our experiment, we set the neighbor distance as 5.Understanding the Importance of the Features: Since weather data is shared in all regions under prediction, we do not evaluate the impact of this feature in our model. Instead, we explore the impacts of soil properties, spectral conditions before planting and NDVI on the cotton yield prediction. We split the data by dimensions and conduct two experiments: the first experiment uses only one dimension feature at a time, the second experiment removes one dimension and use the rest input each time. The comparison and performance are listed in Table 2 and Table 3, respectively. From Table 2, we see that using NDVI data helps to gain better precision compared with using the soil properties data alone and spectral data before planting alone in most of the metrics. It gets MSE and RMSE values at 15, 134.5 and 123.0 while the spectral data produces the worst results, whose MSE and RMSE are 21, 292.5 and 145.9, respectively. On the other hand, Table 3 indicates that if we ignore the spectral feature while keeping the rest, the model achieves the best results compared with ignoring the soil properties and NDVI features. These results demonstrate that the NDVI impacts the prediction the most, then soil properties, while spectral data before planting has the minimal impact. 

Conclusion
This paper proposes a novel Multi-task Learning framework for within-field scale cotton yield prediction, which ingests multiple heterogeneous data sources, such as soil type, weather, topographic, and remote sensing, and is capable of predicting within-field cotton yield throughout the growing season. By aggregating these multiple data sources in the shared layer before transferring to task-specific layers, this creative strategy is able to enhance specific learning task by utilizing sources from other related tasks. To minimize the spatial errors in prediction, this work introduces a spatial regularization to measure the correlations between a certain grid and its neighboring grids. The experimental results show the proposed approach consistently outperforms other competing approaches, and has a promising future in the crop yield prediction research field.
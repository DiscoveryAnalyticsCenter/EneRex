Using temporal abduction for biosignal interpretation: A case study on QRS detection

Abstract
In this work, we propose an abductive framework for biosignal interpretation, based on the concept of Temporal Abstraction Patterns. A temporal abstraction pattern defines an abstraction relation between an observation hypothesis and a set of observations constituting its evidence support. New observations are generated abductively from any subset of the evidence of a pattern, building an abstraction hierarchy of observations in which higher levels contain those observations with greater interpretative value of the physiological processes underlying a given signal. Non-monotonic reasoning techniques have been applied to this model in order to find the best interpretation of a set of initial observations, permitting even to correct these observations by removing, adding or modifying them in order to make them consistent with the available domain knowledge. Some preliminary experiments have been conducted to apply this framework to a well known and bounded problem: the QRS detection on ECG signals. The objective is not to provide a new better QRS detector, but to test the validity of an abductive paradigm. These experiments show that a knowledge base comprising just a few very simple rhythm abstraction patterns can enhance the results of a state of the art algorithm by significantly improving its detection F1-score, besides proving the ability of the abductive framework to correct both sensitivity and specificity failures.

I. INTRODUCTION
A prominent objective of biosignal processing research is to provide classification algorithms for identifying the interesting phenomena from signal samples. Such classifiers can be grouped into two main approaches: (1) a knowledge-based approach, which aims to model the domain or, alternatively, to model an expert reasoning process  #b0 ; and a (2) learningbased approach, which builds a model by estimating the underlying mechanisms that produce the data of a training set  #b1 . Once the classifier is obtained and validated, it behaves at a logical level as a deductive system from a data vector representing the signal. The present work departs from the intrinsic limitations of the deductive framework for coping with the interpretation of biosignals. Indeed, deductive approaches apply a monotonic consequence relation, so that any conclusion cannot be retracted as new evidence becomes available. This entails a propagation of errors from the first processing stages onwards, narrowing the capability of making a proper identification as new processing stages are successively added. Usually, both the above-mentioned approaches overcome this weakness through an artificial adoption of a casuistry-based strategy, yielding to unsatisfactory results so far.The present work starts from the hypothesis that temporal abductive reasoning  #b2  provides a more appropriate framework for the computational interpretation of biosignals. Its greatest strength lies in its non-monotonic nature, so that the conclusions are guessed as conjectures inferred from the available evidence at each time, and further information, at different levels of abstraction, can modify these conclusions. For example, a deductive arrhythmia classifier cannot correctly identify an ECG fragment in which the beats were not properly detected. In contrast, an abductive interpreter could conjecture the presence and morphology of a beat from its context, like a human can reconstruct a speech despite failing to identify all its constituent sounds.This paper provides an abductive framework for biosignal interpretation on the basis of the notion of Temporal Abstraction Pattern, which is a knowledge representation formalism that defines an abstraction relation among a set of domain observables, structuring the problem domain in an abstraction hierarchy, where higher abstraction levels convey more semantic content and more interpretative results. Patterns are generated by means of attributed regular grammars  #b3 , extended in order to address the representation of temporal knowledge through the Simple Temporal Problem formalism  #b4 , previously adopted for temporal abduction in diagnosis  #b5 .The rest of this paper is outlined as follows: Section II defines the main notions of the proposal. Section III describes an interpretation algorithm, based on heuristic searching. Section IV shows the representation of basic ECG knowledge, and how it is used for QRS detection. Finally, section V discusses validation results with respect to a state of the art algorithm, and section VI provides some conclusions.

II. DEFINITIONS
A Simple Temporal Problem (STP)  #b4  defines a set of temporal constraints between pairs of temporal variables, T i and T j . A temporal constraint is a closed interval L(T i , T j ) = [a ij , b ij ] restricting the admissible values for the differenceT j − T i , as a ij ≤ T j − T i ≤ b ij .Formally, a STP can be represented as a tuple N = T , L , where T = {T 1 , . . . , T n } is a set of temporal variables, and L = {L(T i , T j ); 1 ≤ i, j ≤ n} is a set of temporal constraints between them. A tuple (t 1 , ..., t n ) is called a solution of N if the assignment T 1 = t 1 ,...,T n = t n satisfies all the constraints.The basic representation entity of our abductive framework is the observable, which is formally defined as a tuple q = η, A, T b , T e , where η is the name of the observable, A = (A 1 , ..., A nq ) is a set of attributes to be valued, and T b and T e are two temporal variables representing the beginning and the end of the observable. We denote by Q = {q 0 , q 1 , ..., q n } the set of observables of a particular domain, comprising the vocabulary to describe the phenomena of interest. An observable can be observed in multiple instances called observations. An observation is defined as a tuple o = η, v, t b , t e , where η is the name of the observable being instantiated, v is a value assignment for each attribute of the observable, and t b and t e are the specific values for the temporal variables T b and T e . We denote by O(q) = {o q 1 , ..., o q i , ...} the set of observations of the observable q. An example of an observable is q = QRS, shape, T b , T e , which represents a QRS complex with a single attribute describing its morphology. This observable may be instanced in different observations, like for example o q 1 = QRS, shape = QS, 00:32.123, 00:32.201 .Observables are related through abstraction relations defined by temporal abstraction patterns. A temporal abstraction pattern models the necessary knowledge to allow the conjecture of an observation of a high-level observable from observations of lower level observables. We provide a procedure for dynamically generating abstraction patterns, based on the formal language theory. The set Q of observables can be considered as an alphabet represented by their corresponding names. Given an alphabet Q, a formal grammar G denotes a pattern of symbols of the alphabet, describing a language L(G) ⊆ Q * , as a subset of the set of possible strings of symbols of the alphabet. Let G ap be the class of formal attributed grammars of abstraction patterns. A grammar G ∈ G ap is syntactically defined as a tuple (V N , V T , H, R). The production rules in R are of one of the following forms:H = q H → q[l]C C → q[l]D | q[l] | λ H = q His the initial symbol of the grammar, and it plays the role of the hypothesis guessed by the pattern. V N is the set of non-terminal symbols of the grammar. V T is the set of terminal symbols of the grammar, gathering together: a set of observables Q G ⊆ Q, being q = q H for all q ∈ Q G , that can be abstracted by the hypothesis; a set of temporal descriptions [l] in the form of conjunctions of constraints between the temporal variables of the observable produced by the rule and all the observables previously generated; and the empty string, that is represented by λ. Some simple examples of grammars to describe different basic cardiac rhythms in terms of QRS complexes are detailed in section IV.Given a grammar G ∈ G ap , we provide a constructive method for representing a set of abstraction patterns P G = {P 1 , ..., P i , ...}. An abstraction pattern shows a temporal arrangement between a set of observables, possibly appearing repeatedly, to be abstracted by a new observable q H . We call findings to these occurrences of observables that lead to q H , which informally behave as observations that have not yet been observed, that is, predictions generated by the grammar defining an abstraction pattern. Thus, M q P = {m q 1 , m q 2 , ..., m q i = η, A, T i b , T i e , ...} is the set of findings of the observable q in P . P G gathers together the set of abstraction patterns that share the same observable q H to be abstracted, so they represent the different ways of hypothesizing q H .Definition 1: Given G ∈ G ap , a temporal abstraction pattern P = q H P , M P , N P , Π P consists of a hypothesis q H P ; a set of findings M P = q∈Q G M q P that form the evidence supporting q H P ; a temporal network N P between the temporal variables involved in q H P and M P , defined by the [l] attributes of G; and an observation procedure Π P to compute the attribute values of q H P from the observed evidence.Below we show how an abstraction pattern is built by following the productions of a grammar. In every step, a new observable is added, and a set of temporal constraints among this finding and those generated before is introduced in N P . 1) Symbol H entails initializing an abstraction pattern:P ← qH P , MP = ∅, TP = {T H b , T H e }, LP = {L(T H b , T H e )}2) All those productions H = q H P → q[l]C entail:P ← qH P , MP = {m q 1 }, TP ∪ {T 1 b , T 1 e }, LP ∪ L(P, m q 1 ) , L(P, m q 1 ) = L(T 1 b , T 1 e ) ∪ {L(Ti, T 1 j )|Ti ∈ TP ∧ T 1 j ∈ {T 1 b , T 1 e }} 3) All those productions C → q[l]D | q[l] entail: P ← qH P , MP ∪ {m q k }, TP ∪ {T k b , T k e }, LP ∪ L(P, m q k ) , L(P, m q k ) = L(T k b , T k e ) ∪ {L(Ti, T k j )|Ti ∈ TP ∧ T k j ∈ {T k b , T k e }}In case a temporal descriptor is omitted in a production of the G ap grammar, it is assumed the 'after' relationship between the new manifestation and the set of previous manifestations. For instance, all those productions C → qD | q entail:P ← qH , MP ∪ {m q k }, TP ∪ {T k b , T k e }, LP ∪ L(P, m q k ) , L(P, m q k ) = L(T k b , T k e )∪{L(Ti, T k b ) ⊆ Z + |Ti ∈ {T j b , T j e }∧mj ∈ MP }Definition 2: Let Q be a set of observables and P a set of abstraction patterns. We say P induces an abstraction relation in Q × Q, denoted by q i |< q j if and only if there exists a pattern P ∈ P such that:1) q i ∈ M P 2) q j = q H P 3) q i | < + q i , where | < + is the transitive closure of | <The abstraction relation allows us to say that "q j abstracts q i ". This gives a hierarchy structure to the observables of a domain, allowing us to define an abstraction model from a set of abstraction patterns. An interpretation problem so defined gives a different status to the evidence with respect to abductive diagnosis, where the explicit difference between normal and faulty behaviors leads to the definition of faulty findings  #b6 . Only when a faulty finding is provided, the diagnostic process is triggered. In contrast, an interpretation problem based on an abstraction model gives all the findings the same status. The objective is to provide a new description in terms of those observables with the highest possible abstraction level. To do so, and under certain constraints, an observation is tried to be assigned to a specific finding of an abstraction pattern, so that a new observation is obtained for the hypothesis of the pattern.Definition 5: Given an interpretation problem IP , a matching relation for a pattern P ∈ P is an injective relation inM P × O, defined by m q i ← o j , iff m q i = η, A, T i b , T i e ∈ M P and o j = η, v j , t j b , t j e ∈ O.From the notion of matching relation we can design a mechanism for abductively interpreting a subset of observations in O through the use of abstraction patterns. Thus, a matching relation for a given pattern allows to hypothesize new observations from previous ones, and to iteratively incorporate new evidence to the interpretation by means of a hypothesis generation-and-test cycle. The notion of abstraction hypothesis defines those conditions that a subset of observations must satisfy in order to be abstracted by a new observation.Definition 6: Given an interpretation problem IP , we define an abstraction hypothesis as a tupleh = o H h , P h , ← h , where P h ∈ P, ← h ⊆ M P h × O, and we denote O h = {o j1 , . . . , o jn } = image(← h ), satisfying: 1) o H h ∈ O(q H P ) 2) o H h = Π P (O h ) 3) (t H b , t H e , t j1 b , ..., t jn e ) satisfy the constraints of N P . An abstraction hypothesis assigns a set of observations to the findings of the pattern, giving them the role of evidence for the hypothesis. Even though the matching relation is a matter of choice, and therefore a conjecture by itself, some additional constraints could be assumed as default assumptions. An important default assumption in the abstraction of periodic processes states that consecutive observations are related by taking part of the same hypothesis, defining the basic period of the process. This assumption leads to consecutive findings of an observable within an abstraction pattern to be matched to consecutive observations during the abstraction task.As a result of an abstraction hypothesis, a new observation o H h is generated, that should be included in the set of domainobservations, so O = O ∪ {o H h }.The abstraction process then iterates until no new observations are generated. The set of observations that may be abstracted in an interpretation problem IP is O(domain(| <)), that is, the set of observations corresponding to observables playing the role of findings in some abstraction pattern. Figure 1 shows an example of an abstraction hypothesis of the Extrasystole pattern.Definition 7: Given an interpretation problem IP , we de- fine an interpretation as a temporally consistent set of ab-T QRS 0 T QRS 1 T QRS 2 T QRS 3 T Extrasystole b T Extrasystole e T QRS0 T QRS1 L( ) = [200, 2000] , ← 0 o QRS 0 m QRS ← 1 o QRS 1 m QRS ← 2 o QRS 2 m QRS ← 3 o QRS 3 m QRS 0 o BeatAnn 1 o BeatAnn 2 o BeatAnn 3 o BeatAnn 4 o BeatAnn 0 o Extrasystolestraction hypothesis I = {h 1 , ..., h m }, satisfying O hi ∩ O hj = ∅, i = j.The restriction O hi ∩ O hj = ∅ establishes that in the same interpretation an observation cannot be abstracted by more than one hypothesis, formalizing the notion of alternative hypotheses as those abstracting the same observation. 

III. INTERPRETATION ALGORITHM
The purpose of the interpretation algorithm is to obtain the best interpretation for a given set of initial observations. Since a number of different sets of abstraction hypotheses may be obtained with the same base evidence, we need a method to discriminate some interpretations against other. To evaluate and compare the generated interpretations, we rely on the following general principles: The coverage principle, which prefers interpretations explaining more initial observations, and that is calculated as C(I) = | h∈I O h |/|O(domain(|< ))|; the simplicity principle, also known as Occam's razor, which prefers interpretations with fewer hypotheses, and that is calculated as S(I) = 1/(1 + |O H I |); the abstraction principle, which prefers interpretations using terms of higher abstraction levels; and the predictive principle, which prefers interpretations that properly predict future observations.Once we are able to evaluate and compare interpretations, solving an interpretation problem can be posed as a heuristic search on the space of consistent interpretations. The proposed search strategy uses coverage as the main heuristic function, and considers simplicity when the coverage is equal in more than one interpretation. The main drawback of coverage as heuristic is that is non-admissible, and therefore optimality can not be guaranteed, so we require an algorithm efficient with Algorithm 1 Partial Expansion K-Best First Search algorithm. return min(closed) 19: end function this type of heuristics and that saves memory and computing time. We propose an evolution of the K-BFS method  #b7 , named Partial Expansion K-BFS, whose pseudocode is shown in Algorithm 1. The algorithm takes as input an interpretation problem IP , and returns the first found interpretation with full coverage, or the interpretation with the highest coverage factor and highest simplicity if no full coverages are found. The algorithm also needs a K parameter, which determines its exploratory capabilities, and which is set to the maximum number of abstractions that can be made to an observable: K = max({|{q j | q i |< q j }|, q i ∈ Q}). The intuition behind this decision is that at a certain point in the interpretation, and with equal coverage factor, we give an opportunity to every possible hypothesis to continue the interpretation.The distinctive features of PE-KBFS with respect to KBFS are that (1) in each node expansion, only one successor is obtained, greatly limiting the growth of the open list; and (2) the heuristic estimation of the newly generated nodes is propagated to the parent node, resulting in a significant reduction in the number of expansions provided that child nodes are generated ordered by their valuation. These two features are aimed at reducing the number of node expansions, which in our case results in fewer generated interpretations.The search process starts with the so-called trivial interpretation I 0 , the one with no abstraction hypotheses. At each step, each of the K best interpretations generated so far is evolved in a hypothesis-and-test cycle. This cycle is driven by the concept of focus of attention, which is established according to the predictive and abstraction principles and enables to combine different inference modes based on the state of the interpretation. The focus is initially set to the earliest initial observation in the interpretation problem, and its evolution depends on the state of the hypothesis-and-test cycle, managed by the GET SUCCESSORS() function, detailed in Algorithm 2.In the hypothesis step, the focus is on an observation not yet abstracted. Then, abductive reasoning is applied and a hypothesis of a higher abstraction level is generated. This is Algorithm 2 Method for obtaining the successors of an interpretation in the adopted reasoning scheme.  return succ 51: end function implemented in the ABDUCE() function, which explores all the patterns that may abstract the focused observation and, for each of them, it transfers the focus to the evidence findings predicted by the pattern, switching to the test step of the cycle. This reasoning mode enforces the abstraction principle, since it always generates a hypothesis of high abstraction level on the basis of an observation of a lower level.I = O H I , PI , ←I ∪ f ← oi,In the test step, the focus is on a finding predicted by an abstraction pattern of the current interpretation. In this case, two possible inference modes may be used, subsumption and deduction. The SUBSUME() function looks for an existing observation that can be consistently matched with the focus finding, while the DEDUCE() function creates a new observation hypothesis for the matching and then looks for the lower level evidence supporting it. Since an unmatched finding can be seen as a prediction of the knowledge involved in an interpretation, these two inference modes enforce the predictive principle, but inasmuch as subsumption leads to simpler interpretations it is preferred over deduction.The NEXT FINDINGS() function, used both in abduction and deduction, allows to extend an existing hypothesis, returning the possible next findings that may generate a pattern P , obtained through the analysis of the G P grammar. If this function returns nothing, then the focus of attention is set to the earliest observation in the domain of the abstraction relation with the highest possible abstraction level, starting a new hypothesis-and-test cycle.

IV. AN APPLICATION TO ECG QRS DETECTION
In order to test the practical feasibility of this framework, we have defined a simple knowledge base to tackle a well known and bounded problem: QRS detection on ECG signals. This knowledge base assumes as initial observations the QRS annotations identified by any other algorithm, and describes some of the most common rhythm patterns in terms of temporal distances between beats. The temporal consistency with any of these patterns allows us to discriminate those annotations that do not really correspond with QRS complexes, as well as to proactively search for those QRS that, being not initially annotated, are predicted by any of the patterns.The knowledge base defines the following set of observables Q = {q 0 , q 1 , q 2 , q 3 , q 4 , q 5 }, with:q0 = BeatAnn, ∅, T b = Te = T q1 = QRS, ∅, T b = Te = T q2 = NormalRhythm, ∅, T b , Te q3 = Bradycardia, ∅, T b , Te q4 = Tachycardia, ∅, T b , Te q5 = Extrasystole, ∅, T b , Teq 0 represents a beat annotation, the starting point of the interpretation process, and that is considered an instantaneous observable, hence T b = T e ; q 1 represents the QRS complex, which is also an instantaneous observable; q 2 , q 3 and q 4 are different observables for regular cardiac rhythms, and the only difference between them is the maximum and minimum admitted distance between consecutive beats; q 5 represents an extrasystole, which is a cardiac rhythm characterized by the presence of a premature beat and the subsequent return to the previous rhythm with a compensatory pause.Below we show the grammars and observation procedures relating these observables (all temporal constraints are ex-  In the procedures, T 0 represents the time origin, in this case the start of the ECG recording, and therefore L(T 0 , T ) is the interval of possible assignments for the variable T .L(T QRS 0 , T QRS 1 ) = (N|B|T)RR} [l 2n ] = {RR = t QRS n−1 − t QRS n−2 , L(T QRS n−1 , T QRS n ) = (N|B|T)RR ∩ [0.5 · RR, 1.5 · RR], L(T QRS n , T H e ) = [0, 0]} [l 50 ] = {L(T QRS 0 , T Extrasystole b ) = [0, 0]} [l 51 ] = {L(T QRS 0 , T QRS 1 ) = [200, 2000]} [l 52 ] = {RR0 = t QRS 1 − t QRS 0 , L(T QRS 1 , T QRS 2 ) = [200, 0.9 · RR0]} [l 53 ] = {RR1 = t QRS 2 − t QRS 1 , L(T QRS 1 , T QRS 3 ) = [1.7 · RR0, 2.3 · RR0], L(T QRS 2 , T QRS 3 ) = [1.25 · RR1, 4 · RR1]The first pattern P 0 is a purely deductive pattern, since it does not abstract any observable. It is included in the knowledge base in order to allow the discovery of new beat annotations in those cases in which a rhythm pattern predicts the presence of an annotation, but it is not in the initial evidence. The observation procedure Π 0 uses a wavelet-based method detailed in  #b8 , performing a wavelet transformation ψ of the signal in the predicted interval, and emits as hypothesis the time point in which the energy of the transform is greater.The P 1 pattern abstracts the initial annotations in observations of QRS complexes. The pattern introduces as temporal constraint [l 1 ] a maximum distance between the beat annotation point and the QRS location. The observation procedure Π 1 establishes the time instant of the QRS in the point of maximum deviation of the signal with respect to the baseline, estimated as the mode of the signal in the observation interval. As shown in Fig. 1, this procedure allows to change the timing of the initial annotations.Regular rhythms q 2 , q 3 and q 4 share the same pattern grammar P 2 , which requires the presence of at least 3 consecutive QRS complexes with a bounded distance between them. For NormalRhythm, this distance is established to a heart rate of 45-120 bpm; for Bradycardia, the admitted rate is 30-60 bpm; and for Tachycardia, 100-300 bpm. The overlap between patterns allows the correct interpretation of those fragments that are on the frontier of two rhythms. In addition to these static constraints, [l 2n ] introduces an additional constraint limiting the instant rhythm variation. These patterns do not have an observation procedure Π, since the temporal limits are set to the time point of the first and last QRS complexes.The extrasystole pattern P 5 is also defined only by temporal constraints. An extrasystole requires the presence of exactly 4 consecutive beats. The first two define the reference rhythm, while the [l 52 ] constraint sets an upper bound on the duration of the second RR interval, forcing the third beat to be premature. [l 53 ] introduces the compensatory pause constraints, requiring the difference between the second and fourth beats to be approximately two times the previous RR, and a significant increase in the RR interval between the third and fourth beats.With this simple knowledge base, we are able to apply the interpretation algorithm presented in section III in order to obtain the best interpretation of a set of beat annotations, which may be obtained by any external algorithm. To avoid an excessive exploration of the search space if no interpretations with full coverage factor were found, a restriction in the search procedure was included, consisting in limiting the size of the open list to at most K elements (in this case, K = 4) whenever the interpretation process exceeds the real duration of the interpreted signal fragment. This ensures that the interpretation is performed in soft real time. As a result of the interpretation, a new set of annotations will be generated from the QRS observations present in the best interpretation obtained by the algorithm, provided that the observation is included in a rhythm pattern.

V. VALIDATION RESULTS
To validate the ability of the presented framework to revise and correct the results of classical deductive approaches, we have used a state of the art algorithm providing a set of beat annotations for an ECG recording. These annotations are converted to instances of the BeatAnn observable, and form the initial observations upon which the abductive interpretation process is applied. The selected algorithm is the WQRS algorithm  #b9 , included in the standard distribution of the WFDB software package  #b10 . The validation dataset consists of a selection of ECG recordings showing regular rhythms and extrasystoles, and comprises all the 18 recordings of 24 hours duration of the Normal Sinus Rhythm (NSR) database and 20 recordings of 30 minutes duration from the MIT-BIH Arrhythmia database, from the Physionet initiative  #b10 . Table I shows the comparative results of the original algorithm and the corrected output through abduction, in terms of sensitivity, positive predictivity, and the combined F1-score. As can be noted, the abstraction process can slightly decrease the sensitivity, but is compensated with an improvement in the positive predictivity to get in the majority of cases an advance in the combined F1-score. Still, cases such as records MIT-103 or MIT-109 show that the abstraction process is also able to correct sensitivity failures. In order to prove that the improvement on the detection is significant, the Wilcoxon statistical test has been applied to the differences on the F1score, obtaining a p-value of 0.008 on the records of the Normal Sinus Rhythm database, a p-value of 0.033 on the records of the MIT-BIH Arrhythmia database, and a combined p-value of 0.001 on the full set of records. This demonstrates that the improvement is statistically significant.

VI. CONCLUSION
In this paper we have presented an abductive framework to address the problem of biosignal interpretation. We have conducted a validation study to prove that the non-monotonic behavior is able to review the results of classical approaches, trying to enhance a state of the art QRS detector using a very simple knowledge base. The objective was not to provide a new algorithm for QRS detection, but to prove that an abductive approach can overcome the limitations of deductive methods. Results demonstrate the capacity of our proposal to correct and improve the outcomes of the original algorithm. Future plans include building a more complete knowledge base, modeling other ECG constituents, like P and T waves, explicitly considering the morphology of the significant waves, and including more rhythm patterns. This is expected to provide a more interpretative information, helping to improve previous results on ECG processing at all abstraction levels, from QRS detection to arrhythmia recognition.